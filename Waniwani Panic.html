<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Waniwani Panic</title>
    <style>
        /* ã‚²ãƒ¼ãƒ å…¨ä½“ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        .game-container {
            width: 600px; 
            height: 300px; /* ç¸¦ã®ã‚µã‚¤ã‚ºã‚‚æŒ‡å®š */
            display: grid;
            grid-template-columns: repeat(4, 1fr); /* 4åˆ—ã§å‡ç­‰ã«é…ç½® */
            grid-template-rows: repeat(2, 1fr); /* 2è¡Œã§å‡ç­‰ã«é…ç½® */
            margin: 50px auto; /* ä¸­å¤®å¯„ã› */
            gap: 2px; /* ãƒã‚¹ç›®ã®éš™é–“èª¿æ•´ */
            background-color: skyblue; /* é’æ  */
        }
        /* æ–‡å­—ï¼ˆãƒ¯ãƒ‹ãƒ¯ãƒ‹ãƒ‘ãƒ‹ãƒƒã‚¯ã®èµ¤ã„è¡¨ç¤ºï¼‰ */
        .letter {
            position: absolute;
            font-size: 24px;
            font-weight: bold;
            color: red;
            text-align: center;
            width: 100%;
            top: 5px;  /* æ–‡å­—ã®ä½ç½®ã‚’èª¿æ•´ */
        }
        /* ç©´ï¼ˆãƒ¯ãƒ‹ãŒå‡ºã¦ãã‚‹å ´æ‰€ï¼‰ */
        .hole {
            width: 140px; /* æ ã®å¹…ã‚’èª¿æ•´ */
            height: 140px; /* ç¸¦ã®ã‚µã‚¤ã‚ºã‚’æ­£ã—ãè¨­å®š */
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: skyblue; /* é’ç³»ã®ç©´ã®èƒŒæ™¯è‰² */
            border: 4px solid darkblue; /* ç©´ã®æ ç·šã‚’è¿½åŠ  */
            border-radius: 12px; /* ä¸¸ã¿ã‚’ã¤ã‘ã¦è¦‹æ „ãˆã‚’ã‚ˆãã™ã‚‹ */
            box-shadow: inset 0 3px 6px rgba(0,0,0,0.2); /* ç©´ã®å‡¹å‡¸æ„Ÿã‚’è¿½åŠ  */
        }
        .hole-text {
            position: absolute;
            font-size: 24px;
            font-weight: bold;
            color: white;
            text-align: center;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2; /* æ–‡å­—ã‚’å‰é¢ã« */
        }

        /* ãƒ¯ãƒ‹ã®è¨­å®š */
        .wani {
            width: 100%; /* æ ã‚ˆã‚Šå°‘ã—å°ã•ã‚ã«èª¿æ•´ */
            height: 100%;
            position: absolute;
            bottom: -100%; /*  åˆæœŸä½ç½®ã‚’æ ã®å¤–ã« */
            transition: bottom 0.2s ease-in-out; /*  å‡ºå…¥ã‚Šã‚’ã‚¹ãƒ ãƒ¼ã‚ºã« */
        }
        .wani img {
            width: 100%; /*  æ ã«ãƒ”ãƒƒã‚¿ãƒªåˆã†ã‚ˆã†ã«è¨­å®š */
            height: auto; /* è‡ªç„¶ãªæ¯”ç‡ã§è¡¨ç¤º */
            object-fit: contain; /* ç”»åƒã®æ¯”ç‡ã‚’ä¿ã¡ã¤ã¤ãƒ•ã‚£ãƒƒãƒˆ */
            display: block;
        }
        /* ãƒ¯ãƒ‹ãŒå‡ºãŸã‚‰æ–‡å­—ã‚’éè¡¨ç¤º */
        .hole .wani.show + .hole-text {
            display: none;
        }
        .wani, .hole {
            display: block; /* ãƒ¯ãƒ‹ã¨æ ã®è¡¨ç¤º */
        }
        /* ãƒ¯ãƒ‹ãŒå‡ºã¦ãã‚‹æ™‚ã®å‹•ã */
        .wani.show {
            bottom: 0;
        }
        .hole.hit{
            background-color: darkgray; /* å©ã„ãŸç¬é–“ã€ç©´ãŒæš—ããªã‚‹ */
            transition: background-color 0.2s ease-in-out;
        }
        body {
            position: relative;/* ãƒãƒ³ãƒãƒ¼ã®åŸºæº–ã‚’`body`ã«ã™ã‚‹ */
            overflow: hidden;/* ç”»é¢å¤–ã«ãƒãƒ³ãƒãƒ¼ãŒè¡Œã‹ãªã„ã‚ˆã†ã«ã™ã‚‹ */
        }
        .hammer {
            position: absolute;
            width: 100px;/* ã‚µã‚¤ã‚ºèª¿æ•´ï¼ˆé©å®œå¤‰æ›´ï¼‰ */
            height: 100px;
            pointer-events: none;/* ã‚¯ãƒªãƒƒã‚¯ã‚’ç„¡åŠ¹åŒ–ï¼ˆã‚²ãƒ¼ãƒ ã®å‹•ä½œã‚’é‚ªé­”ã—ãªã„ï¼‰ */
        }
        /* ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        #startScreen {
            display: block;  /* â† ã“ã“ã‚’ä¿®æ­£ï¼ */
            text-align: center;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white; /* ç”»é¢ã‚’è¦‹ã‚„ã™ãã™ã‚‹ */
        }
        .start-wani {
            display: block;
            margin: 20px auto;
            width: 200px; /* é©å®œèª¿æ•´ */
        }
        #gameScreen {
            display: none;/* æœ€åˆã¯éè¡¨ç¤º */
            text-align: center;
        }
        #hammer {
            position: absolute;
            width: 100px; /* ãƒãƒ³ãƒãƒ¼ã®ã‚µã‚¤ã‚º */
            height: 100px;
            pointer-events: none;/* ã‚¯ãƒªãƒƒã‚¯æ™‚ã‚’ç„¡åŠ¹åŒ–ï¼ˆã‚²ãƒ¼ãƒ å‹•ä½œã®é‚ªé­”ã‚’ã—ãªã„ */
            transform: rotate(20deg);/* ãƒãƒ³ãƒãƒ¼ã‚’å³ã«å‚¾ã‘ã‚‹ */
            transition: transform 0.1s;/* ã‚¯ãƒªãƒƒã‚¯æ™‚ã«ãƒãƒ³ãƒãƒ¼ãŒå‹•ã */
            z-index: 1000;/* ãƒãƒ³ãƒãƒ¼ã‚’æœ€å‰é¢ã« */
        }
    </style>
</head>
<body>
    <div id="startScreen">
    <h1>ãƒ¯ãƒ‹ãƒ¯ãƒ‹ãƒ‘ãƒ‹ãƒƒã‚¯</h1>
    <button id="startButton">START</button>
    <img src="images/startwani.png" alt="ã‚¹ã‚¿ãƒ¼ãƒˆãƒ¯ãƒ‹" class="start-wani">
    <audio id="startSound" src="sounds/start.mp3"></audio>
    </div>

    <div id="gameScreen" style="display: none;">
    <h1>ãƒ¯ãƒ‹ãƒ¯ãƒ‹ãƒ‘ãƒ‹ãƒƒã‚¯</h1>
    <p>ã‚¹ã‚³ã‚¢:<span id="score">0</span></p>
    <p>æ®‹ã‚Šæ™‚é–“: <span id="timer">30</span>ç§’</p>
    <div class="game-container">
        <div class="hole">
            <div class="wani" style="display: none;"></div>
            <span class="hole-text">ãƒ¯</span>
        </div>
        
        <div class="hole">
            <div class="wani" style="display: none;"></div>
            <span class="hole-text">ãƒ‹</span>
        </div>
        
        <div class="hole">
            <div class="wani" style="display: none;"></div>
            <span class="hole-text">ãƒ¯</span>
        </div>
        
        <div class="hole">
            <div class="wani" style="display: none;"></div>
            <span class="hole-text">ãƒ‹</span>
        </div>
        
        <div class="hole">
            <div class="wani" style="display: none;"></div>
            <span class="hole-text">ãƒ‘</span>
        </div>
        
        <div class="hole">
            <div class="wani" style="display: none;"></div>
            <span class="hole-text">ãƒ‹</span>
        </div>
        
        <div class="hole">
            <div class="wani" style="display: none;"></div>
            <span class="hole-text">ãƒƒ</span>
        </div>
        
        <div class="hole">
            <div class="wani" style="display: none;"></div>
            <span class="hole-text">ã‚¯</span>
        </div>
        
    </div>

    <div id="balloon" style="display:none; position:absolute; padding:8px 15px; background:white; border:3px solid #444; border-radius:10px; font-weight:bold; color:#333; z-index:5000;"></div>

    <!-- ã‚²ãƒ¼ãƒ ç”»é¢å†…ã®ä»»æ„ã®ä½ç½®ã«è¿½åŠ  -->
    <div id="fukidashi" style="
        display:none;
        position:absolute;
        padding:10px 15px;
        background-color:#fff;
        border:3px solid #555;
        border-radius:10px;
        color:#333;
        font-weight:bold;
        z-index:2000;
        ">
        </div>

    <!-- <button onclick="startGame()">ã‚¹ã‚¿ãƒ¼ãƒˆ</button> -->
    <img id="hammer" src="./images/hammer.png" style="position: absolute; width:80px; height: 80px; pointer-events: none; display: none;">
    <audio id="hitSound" src="sounds/piko.mp3" preload="auto"></audio>
    <audio id="correctSound" src="sounds/correct.mp3" preload="auto" allow="autoplay"></audio>
    <audio id="wrongSound" src="sounds/wrong.mp3" preload="auto" allow="autoplay"></audio>
    <audio id="startSound" src="sounds/start.mp3" preload="auto" allow="autoplay"></audio>
    <audio id="gameStartVoice" src="sounds/startkoe.mp3" preload="auto"></audio> <!-- ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆã®å£° -->
    <audio id="gameEndVoice" src="sounds/owarikoe.mp3" preload="auto"></audio>   <!-- ã‚²ãƒ¼ãƒ çµ‚äº†ã®å£° -->

</div>
    <script>
    window.onload = () => {
        const startButton = document.getElementById('startButton');
        if(startButton) {
            console.log("ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸï¼");
            
            startButton.addEventListener('click', () => {
                console.log("ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸï¼");
                
                //  ã™ã¹ã¦ã®éŸ³ã®ãƒŸãƒ¥ãƒ¼ãƒˆè§£é™¤
                document.querySelectorAll("audio").forEach(audio => {
                audio.muted = false;
            });

                document.getElementById('startScreen').style.display = 'none';
                document.getElementById('gameScreen').style.display = 'block';
                document.getElementById('hammer').style.display = 'block';
                playSound("startSound"); //  ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œæ™‚ã«ç¢ºå®Ÿã«éŸ³ã‚’é³´ã‚‰ã™
                startGame();
            });
            // ãƒšãƒ¼ã‚¸ã‚’é–‹ã„ãŸç¬é–“ã«ã€Œãƒ¯ãƒ‹ãƒ¯ãƒ‹ãƒ‘ãƒ‹ãƒƒã‚¯ã€ã®å£°ã‚’å†ç”Ÿã™ã‚‹
        playSound("startSound"); 
        }else{
        console.log("âš ï¸ startButtonãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ï¼");
        }
    };
    //ã‚¹ã‚³ã‚¢ã¨ã‚¿ã‚¤ãƒãƒ¼
    let score = 0;
    let timeLeft = 30;
    let waniTimer;
    let countDownTimer;
    //éŸ³ã‚’å†ç”Ÿã™ã‚‹é–¢æ•°
    function playSound(soundId) {
        const sound = document.getElementById(soundId);
        if (sound) {
            sound.muted = false;//  ç¢ºå®Ÿã«ãƒŸãƒ¥ãƒ¼ãƒˆè§£é™¤ï¼
            sound.volume = 1.0; //  éŸ³é‡ã‚’æœ€å¤§ã«è¨­å®š
            sound.currentTime = 0; // éŸ³ã‚’æœ€åˆã‹ã‚‰å†ç”Ÿ
            sound.play()
            .then(() => console.log(`ğŸ”Š ${soundId} ã®éŸ³ãŒå†ç”Ÿã•ã‚Œã¾ã—ãŸï¼`))
            .catch(e => {
                console.log(`âš ï¸ éŸ³å£°ã®å†ç”Ÿã‚¨ãƒ©ãƒ¼: ${e.message}`);
                console.log("`play()`ã®å¤±æ•—ã‚’æ¤œçŸ¥ï¼ã‚‚ã†ä¸€åº¦è©¦ã—ã¾ã™ï¼");
                setTimeout(()=>{
                    sound.play().catch(e=>console.log(`å†è©¦è¡Œå¤±æ•—:${e.message}`));
                },500);
            });
        } else {
            console.log(`âš ï¸ ${soundId} ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ï¼`);
        }
    }


    function startGame() {
    // è‡ªå‹•å†ç”Ÿãƒãƒªã‚·ãƒ¼ã‚’å›é¿ã™ã‚‹ãŸã‚ã®å‡¦ç†ï¼ˆä¸€ç¬å†ç”Ÿã—ã¦åœæ­¢ï¼‰
    ['correctSound', 'wrongSound', 'startSound'].forEach(id => {
        const sound = document.getElementById(id);
        if (sound) {
            sound.muted = false;
            sound.volume = 0.01;
            sound.play().then(() => sound.pause());
            sound.currentTime = 0;
            sound.volume = 1.0;
        }
    });
        score = 0;
        timeLeft = 30;
    document.getElementById("score").textContent = score;
    document.getElementById("timer").textContent = timeLeft;

        clearInterval(waniTimer);
        clearInterval(countDownTimer);

        // ãƒ¯ãƒ‹ã‚’æœ€åˆã«ä¸€åº¦è¡¨ç¤º
        showWani();

        // ãƒ¯ãƒ‹ã‚’1.5ç§’ã”ã¨ã«å†è¡¨ç¤ºã™ã‚‹
    waniTimer = setInterval(showWani, 1500);

        // ã‚¿ã‚¤ãƒãƒ¼ã‚’1ç§’ã”ã¨ã«æ¸›ã‚‰ã™
    countDownTimer = setInterval(countDown, 1000);
        // â†ã“ã“ã‚’è¿½åŠ ï¼ˆã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆéŸ³å£°ã‚’å†ç”Ÿï¼‰
    playSound("gameStartVoice"); 
    }

    function showWani() {
    const holes = document.querySelectorAll('.hole');

    document.querySelectorAll('.wani').forEach(w => {
        w.classList.remove('show');
        w.style.display = 'none';
        w.innerHTML = '';
    });

    const randomHole = holes[Math.floor(Math.random() * holes.length)];
    let wani = randomHole.querySelector('.wani');
    if (!wani) return;

    let imageName;
    if(Math.random() < 0.7){
        imageName = "wani.png";
        wani.dataset.type = "correct";
        wani.dataset.animal = "ãƒ¯ãƒ‹";
    }else{
    if(Math.random() <0.5){
        imageName = "wanigame.png";
        wani.dataset.animal = "ãƒ¯ãƒ‹ã‚¬ãƒ¡";
    }else{
        imageName = "iguana.png";
        wani.dataset.animal = "ã‚¤ã‚°ã‚¢ãƒŠ";
    }
    wani.dataset.type = "wrong";
    }

    wani.classList.add('show');
    wani.style.display = 'block';
    wani.innerHTML = `<img src="./images/${imageName}" alt="wani" class="wani-image" style="width:100%; height:100%; object-fit:cover;">`;
    // ãƒ¯ãƒ‹ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¦ªè¦ç´ ï¼ˆç©´ï¼‰ã«è¨­å®šã™ã‚‹æ–¹æ³•
    randomHole.onclick = function(event){
        event.stopPropagation();

        if (!wani.dataset.type) {
            console.log("âš ï¸ ãƒ¯ãƒ‹ã®ã‚¿ã‚¤ãƒ—æœªè¨­å®šï¼");
            return;
        }

        const waniType = wani.dataset.type;
        if (waniType === "correct") {
            score += 1;
            playSound("correctSound");
        } else if (waniType === "wrong") {
            score = Math.max(0, score - 1);
            playSound("wrongSound");

            //ã‚¯ãƒªãƒƒã‚¯æ™‚ã«å¹ãå‡ºã—ã‚’è¡¨ç¤ºã™ã‚‹å‡¦ç†ã‚’ã“ã“ã«è¿½åŠ 
            showBalloon(event.clientX, event.clientY, `ãã‚Œã¯${wani.dataset.animal}ã ã‚ˆï¼`);
        }

        document.getElementById("score").textContent = score;

        wani.classList.remove("show");
        wani.style.display = "none";
        wani.innerHTML = "";
        wani.dataset.type = ""; // ã‚¯ãƒªãƒƒã‚¯å¾Œã¯ã‚¿ã‚¤ãƒ—ã‚’ãƒªã‚»ãƒƒãƒˆ
    };

    // ãƒ¯ãƒ‹ã‚’ä¸€å®šæ™‚é–“ã§è‡ªå‹•éè¡¨ç¤º
    setTimeout(() => {
        wani.classList.remove('show');
        wani.style.display = 'none';
        wani.innerHTML = '';
        wani.dataset.type = "";
    }, 1000); //ãƒ¯ãƒ‹ã®è¡¨ç¤ºæ™‚é–“ã¯1ç§’ã«å»¶é•·ï¼ˆã‚¯ãƒªãƒƒã‚¯ã—ã‚„ã™ãï¼‰
}


function countDown() {
    timeLeft--;
    document.getElementById('timer').textContent = `${timeLeft}`;

    if (timeLeft < 0) {
        clearInterval(waniTimer);
        clearInterval(countDownTimer);
        playSound("gameEndVoice");

        // çµæœè¡¨ç¤ºã®å‡¦ç†ã‚’è¿½åŠ 
        showResultScreen(score);
    }
}

// çµæœç”»é¢è¡¨ç¤ºé–¢æ•°ã‚’æ–°ã—ãè¿½åŠ ã™ã‚‹
function showResultScreen(score) {
    let message, image;

    if (score >= 13) {
        message = "å¤©æ‰ï¼";
        image = "images/tensai.webp";
    } else if (score >= 10) {
        message = "ã‚ˆãå‡ºæ¥ã¾ã—ãŸ";
        image = "images/yokudekimasita.webp";
    } else if (score >= 7) {
        message = "ã¾ãã¾ãã ã­";
        image = "images/mamadane.webp";
    } else if (score >= 4) {
        message = "å…¨ç„¶ãƒ€ãƒ¡ã˜ã‚ƒã‚“...";
        image = "images/zennzendame.webp";
    } else {
        message = "ã‚„ã‚Šç›´ã—ï¼ï¼";
        image = "images/yarinaosi.webp";
    }

    document.getElementById("resultMessage").textContent = message;
    document.getElementById("resultCharacter").src = image;

    // çµæœç”»é¢ã‚’è¡¨ç¤º
    document.getElementById("resultScreen").style.display = "flex";
    }

    
    //ãƒãƒ³ãƒãƒ¼ã‚’ãƒã‚¦ã‚¹ã«è¿½å¾“ã•ã›ã‚‹
    document.addEventListener("mousemove", (event) => {
    const hammer = document.getElementById("hammer");
        if (hammer) {
            hammer.style.display = "block"; // ç¢ºå®Ÿã«è¡¨ç¤º
            hammer.style.left = `${event.clientX - 50}px`; // ãƒãƒ³ãƒãƒ¼ã®ä½ç½®èª¿æ•´
            hammer.style.top = `${event.clientY - 50}px`;
        } else {
            console.log("âš ï¸ ãƒãƒ³ãƒãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ï¼");
        }
    });
    //é–“é•ã£ãŸãƒ¯ãƒ‹ã®ã‚³ãƒ¡ãƒ³ãƒˆ
    function showBalloon(x, y, message){
    const balloon = document.getElementById("balloon");
        balloon.textContent = message;
        balloon.style.left = (x + 20) + 'px';
        balloon.style.top = (y - 50) + 'px';
        balloon.style.display = 'block';

    setTimeout(()=>{ balloon.style.display='none'; },1000);//1ç§’å¾Œæ¶ˆãˆã‚‹
}
</script>
    <!-- çµæœè¡¨ç¤ºç”»é¢ -->
    <div id="resultScreen"
        style=
        "display:none; 
        position:absolute; top:0; left:0; 
        width:100%; 
        height:100%; 
        background-color: rgba(0,0,0,0.8); 
        color: #fff; 
        align-items:center; 
        justify-content:center; 
        flex-direction:column; z-index:9999;
        ">
    <img id="resultCharacter" src="" alt="çµæœã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼" style="width:200px; height:auto; margin-bottom:20px;">
    <div id="resultMessage" style="
        background-color:#fff; 
        padding:10px 20px; 
        border-radius:10px; 
        color:#333; 
        font-size:24px; font-weight:bold;
        "></div>
    <button onclick="location.reload();" style="
        padding:10px 20px; margin-top:20px; 
        border:none; border-radius:8px; 
        background-color:#4CAF50; color:#fff; 
        font-size:18px; cursor:pointer;
        ">
        ã‚‚ã†ä¸€åº¦éŠã¶
    </button>
    </div>

</body>
</html>